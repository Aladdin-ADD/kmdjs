(function (n) { function l(n, t, u) { var f = i.createElement("script"), s; u && (s = isFunction(u) ? u(n) : u, s && (f.charset = s)), a(f, t, n), f.async = !0, f.src = n, o = f, e ? r.insertBefore(f, e) : r.appendChild(f), o = null } function a(n, t, i) { function u(i) { n.onload = n.onerror = n.onreadystatechange = null, c.debug || r.removeChild(n), n = null, t(i) } var f = "onload" in n; f ? (n.onload = u, n.onerror = function () { throw "bad request!__" + i + "  404 (Not Found) "; }) : n.onreadystatechange = function () { /loaded|complete/.test(n.readyState) && u() } } function v(n, t) { var r, i; if (n.lastIndexOf) return n.lastIndexOf(t); for (r = t.length, i = n.length - 1 - r; i > -1; i--) if (t === n.substr(i, r)) return i; return -1 } var h = "HelloKanvas", i = document, c = {}, r = i.head || i.getElementsByTagName("head")[0] || i.documentElement, e = r.getElementsByTagName("base")[0], o, u = {}, t; u.get = function (n, i) { var f, e, o, u, r, s; for (typeof n == "string" && (n = [n]), r = 0, u = n.length; r < u; r++) v(n[r], ".") == -1 && (n[r] = h + "." + n[r]); for (f = !0, e = [], r = 0, u = n.length; r < u; r++) t.modules[n[r]] ? e.push(t.modules[n[r]]) : f = !1; if (f) i.apply(null, e); else for (o = 0, u = n.length, r = 0; r < u; r++) s = [], l(n[r] + ".js", function () { if (o++, o == u) { for (var r = 0; r < u; r++) t.modules[n[r]] && s.push(t.modules[n[r]]); i.apply(null, s) } }) }, u.exec = function (n) { for (var u, o, s, r = 0, f = n.length; r < f; r++) { var i = n[r], e = [], h = new Function(i.a, i.b); for (u = 0, o = i.d.length; u < o; u++) e.push(t.modules[i.d[u]]); s = h.apply(null, e), t.modules[i.c] = s } }, n.kmdjs = u; var f = !1, y = /xyz/.test(function () { xyz }) ? /\b_super\b/ : /.*/, s = function () { }; s.extend = function (n) { function i() { !f && this.ctor && this.ctor.apply(this, arguments) } var e = this.prototype, u, r, t; f = !0, u = new this, f = !1; for (t in n) t != "statics" && (u[t] = typeof n[t] == "function" && typeof e[t] == "function" && y.test(n[t]) ? function (n, t) { return function () { var r = this._super, i; return this._super = e[n], i = t.apply(this, arguments), this._super = r, i } }(t, n[t]) : n[t]); for (r in this) this.hasOwnProperty(r) && r != "extend" && (i[r] = this[r]); if (n.statics) for (t in n.statics) t == "ctor" ? n.statics[t].call(i) : i[t] = n.statics[t]; return i.prototype = u, i.prototype.constructor = i, i.extend = arguments.callee, i }, n.__class = s, t = {}, t.modules = {}, n.__modules = t.modules, t.all = [{ "a": [], "b": "var t=__class.extend({statics:{DEG_TO_RAD:.017453292519943295},ctor:function(t,e,i,n,s,a){return this.a=null==t?1:t,this.b=e||0,this.c=i||0,this.d=null==n?1:n,this.tx=s||0,this.ty=a||0,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},appendTransform:function(e,i,n,s,a,r,o,h,c){if(a%360)var l=a*t.DEG_TO_RAD,u=Math.cos(l),d=Math.sin(l);else u=1,d=0;return r||o?(r*=t.DEG_TO_RAD,o*=t.DEG_TO_RAD,this.append(Math.cos(o),Math.sin(o),-Math.sin(r),Math.cos(r),e,i),this.append(u*n,d*n,-d*s,u*s,0,0)):this.append(u*n,d*n,-d*s,u*s,e,i),(h||c)&&(this.tx-=h*this.a+c*this.c,this.ty-=h*this.b+c*this.d),this},append:function(t,e,i,n,s,a){var r=this.a,o=this.b,h=this.c,c=this.d;return this.a=t*r+e*h,this.b=t*o+e*c,this.c=i*r+n*h,this.d=i*o+n*c,this.tx=s*r+a*h+this.tx,this.ty=s*o+a*c+this.ty,this}});return t", "c": "Kanvas.Matrix2D", "d": [] }, { "a": ["Matrix2D"], "b": "var t=__class.extend({statics:{ctor:function(){this.HitCanvas=document.querySelector(\"#testHit\"),this.HitCtx=this.HitCanvas.getContext(\"2d\")}},ctor:function(){this.scaleX=this.scaleY=1,this.x=this.y=this.rotation=this.regX=this.regY=this.skewX=this.skewY=0,this._matrix=new Matrix2D},updateContext:function(t){var e=this._matrix.identity().appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY);t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)}});return t", "c": "Kanvas.DisplayObject", "d": ["Kanvas.Matrix2D"] }, { "a": ["DisplayObject"], "b": "var t=__modules[\"Kanvas.DisplayObject\"].extend({ctor:function(){this.children=[]},draw:function(t){for(var e=0,n=this.children.length;n>e;e++){var i=this.children[e];t.save(),i.updateContext(t),i.draw(t),t.restore()}},_getHitChild:function(e,n){for(var i=t.HitCtx,s=this.children.length,o=s-1;o>=0;o--){var r=this.children[o];if(i.save(),r.updateContext(i),r.draw(i),i.restore(),i.getImageData(e,n,1,1).data[3]>1)return r}}});return t", "c": "Kanvas.Container", "d": ["Kanvas.DisplayObject"] }, { "a": ["Container"], "b": "var t=__modules[\"Kanvas.Container\"].extend({ctor:function(t){this._super(),this.canvas=\"string\"==typeof t?document.querySelector(t):t,this.ctx=this.canvas.getContext(\"2d\"),this.width=this.canvas.width,this.height=this.canvas.height,Function.prototype.bind=function(){var t=this,e=Array.prototype.slice.call(arguments),n=e.shift();return function(){return t.apply(n,e.concat(Array.prototype.slice.call(arguments)))}},this.canvas.addEventListener(\"click\",this._handleClick.bind(this),!1),this.offset=this._getXY(this.canvas)},add:function(t){this.children.push(t)},update:function(){this.ctx.clearRect(0,0,this.width,this.height),this.draw(this.ctx)},_handleClick:function(t){var e=this._getHitChild(t.pageX-this.offset[0],t.pageY-this.offset[1]);alert(e?\"你点中了文字！！！！！！！！！！\":\"你没点中文字\")},_getClientXY:function(t){var e=0,n=0;if(t)if(document.documentElement.getBoundingClientRect&&t.getBoundingClientRect){var i={left:0,top:0,right:0,bottom:0};try{i=t.getBoundingClientRect(),n=i.left,e=i.top}catch(o){return alert(1),[0,0]}}else for(;t.offsetParent;)e+=t.offsetTop,n+=t.offsetLeft,t=t.offsetParent;return[n,e]},_getXY:function(t){var e=this._getClientXY(t);return e[0]=e[0]+this._getScrollLeft(),e[1]=e[1]+this._getScrollTop(),e},_getScrollLeft:function(t){var e;return e=t?t.scrollLeft:Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),e||0},_getScrollTop:function(t){var e;return e=t?t.scrollTop:Math.max(document.documentElement.scrollTop,document.body.scrollTop),e||0}});return t", "c": "Kanvas.Stage", "d": ["Kanvas.Container"] }, { "a": ["DisplayObject"], "b": "var t=__modules[\"Kanvas.DisplayObject\"].extend({ctor:function(t,e,n){this._super(),this.text=t,this.font=e,this.color=n,this.textAlign=\"left\",this.textBaseline=\"top\"},draw:function(t){t.fillStyle=this.color,t.font=this.font,t.textAlign=this.textAlign||\"left\",t.textBaseline=this.textBaseline||\"top\",t.fillText(this.text,0,0)}});return t", "c": "Kanvas.Txt", "d": ["Kanvas.DisplayObject"] }, { "a": ["Stage", "Txt"], "b": "var a=__class.extend({ctor:function(){var a=new Stage(\"#ourCanvas\"),e=new Txt(\"Hello Kanvas!\",\"bold 36px Arial\",\"green\");e.x=140,e.y=100,e.regX=100,e.regY=20,e.skewX=30,e.skewY=-30,e.rotation=20,a.add(e),a.update();var n=new Txt(\"KMD:Kill AMD and CMD!\",\"bold 26px Arial\",\"red\");n.y=400,a.add(n);var r=new Txt(\"Click AnyWhere!\",\"bold 26px Arial\",\"blue\");r.y=250,r.x=50,a.add(r),setInterval(function(){e.rotation++,a.update()},15)}});return a", "c": "HelloKanvas.Main", "d": ["Kanvas.Stage", "Kanvas.Txt"] }], u.exec(t.all), new t.modules["HelloKanvas.Main"] })(this)
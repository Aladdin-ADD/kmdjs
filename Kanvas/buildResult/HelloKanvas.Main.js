(function (n) { function l(n, t, u) { var f = i.createElement("script"), s; u && (s = isFunction(u) ? u(n) : u, s && (f.charset = s)), a(f, t, n), f.async = !0, f.src = n, o = f, e ? r.insertBefore(f, e) : r.appendChild(f), o = null } function a(n, t, i) { function u(i) { n.onload = n.onerror = n.onreadystatechange = null, c.debug || r.removeChild(n), n = null, t(i) } var f = "onload" in n; f ? (n.onload = u, n.onerror = function () { throw "bad request!__" + i + "  404 (Not Found) "; }) : n.onreadystatechange = function () { /loaded|complete/.test(n.readyState) && u() } } function v(n, t) { var r, i; if (n.lastIndexOf) return n.lastIndexOf(t); for (r = t.length, i = n.length - 1 - r; i > -1; i--) if (t === n.substr(i, r)) return i; return -1 } var h = "HelloKanvas", i = document, c = {}, r = i.head || i.getElementsByTagName("head")[0] || i.documentElement, e = r.getElementsByTagName("base")[0], o, u = {}, t; u.get = function (n, i) { var f, e, o, u, r, s; for (typeof n == "string" && (n = [n]), r = 0, u = n.length; r < u; r++) v(n[r], ".") == -1 && (n[r] = h + "." + n[r]); for (f = !0, e = [], r = 0, u = n.length; r < u; r++) t.modules[n[r]] ? e.push(t.modules[n[r]]) : f = !1; if (f) i.apply(null, e); else for (o = 0, u = n.length, r = 0; r < u; r++) s = [], l(n[r] + ".js", function () { if (o++, o == u) { for (var r = 0; r < u; r++) t.modules[n[r]] && s.push(t.modules[n[r]]); i.apply(null, s) } }) }, u.exec = function (n) { for (var u, o, s, r = 0, f = n.length; r < f; r++) { var i = n[r], e = [], h = new Function(i.a, i.b); for (u = 0, o = i.d.length; u < o; u++) e.push(t.modules[i.d[u]]); s = h.apply(null, e), t.modules[i.c] = s } }, n.kmdjs = u; var f = !1, y = /xyz/.test(function () { xyz }) ? /\b_super\b/ : /.*/, s = function () { }; s.extend = function (n) { function i() { !f && this.ctor && this.ctor.apply(this, arguments) } var e = this.prototype, u, r, t; f = !0, u = new this, f = !1; for (t in n) t != "statics" && (u[t] = typeof n[t] == "function" && typeof e[t] == "function" && y.test(n[t]) ? function (n, t) { return function () { var r = this._super, i; return this._super = e[n], i = t.apply(this, arguments), this._super = r, i } }(t, n[t]) : n[t]); for (r in this) this.hasOwnProperty(r) && r != "extend" && (i[r] = this[r]); if (n.statics) for (t in n.statics) t == "ctor" ? n.statics[t].call(i) : i[t] = n.statics[t]; return i.prototype = u, i.prototype.constructor = i, i.extend = arguments.callee, i }, n.__class = s, t = {}, t.modules = {}, n.__modules = t.modules, t.all = [{ "a": [], "b": "var t=__class.extend({statics:{DEG_TO_RAD:.017453292519943295},ctor:function(t,i,e,n,s,a){return this.a=null==t?1:t,this.b=i||0,this.c=e||0,this.d=null==n?1:n,this.tx=s||0,this.ty=a||0,this},identity:function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},appendTransform:function(i,e,n,s,a,r,o,h,c){if(a%360)var l=a*t.DEG_TO_RAD,u=Math.cos(l),d=Math.sin(l);else u=1,d=0;return r||o?(r*=t.DEG_TO_RAD,o*=t.DEG_TO_RAD,this.append(Math.cos(o),Math.sin(o),-Math.sin(r),Math.cos(r),i,e),this.append(u*n,d*n,-d*s,u*s,0,0)):this.append(u*n,d*n,-d*s,u*s,i,e),(h||c)&&(this.tx-=h*this.a+c*this.c,this.ty-=h*this.b+c*this.d),this},append:function(t,i,e,n,s,a){var r=this.a,o=this.b,h=this.c,c=this.d;return this.a=t*r+i*h,this.b=t*o+i*c,this.c=e*r+n*h,this.d=e*o+n*c,this.tx=s*r+a*h+this.tx,this.ty=s*o+a*c+this.ty,this}});return t", "c": "Kanvas.Matrix2D", "d": [] }, { "a": ["Matrix2D"], "b": "var t=__class.extend({ctor:function(){this.scaleX=this.scaleY=1,this.x=this.y=this.rotation=this.regX=this.regY=this.skewX=this.skewY=0,this._matrix=new Matrix2D,this.events={}},updateContext:function(t){var e=this._matrix.identity().appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY);t.transform(e.a,e.b,e.c,e.d,e.tx,e.ty)},on:function(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)},execEvent:function(t){var e=this.events[t.type];if(e)for(var n=0,i=e.length;i>n;n++)e[n].call(this)}});return t", "c": "Kanvas.DisplayObject", "d": ["Kanvas.Matrix2D"] }, { "a": ["DisplayObject"], "b": "var t=__modules[\"Kanvas.DisplayObject\"].extend({ctor:function(){this._super(),this.children=[]},draw:function(t){for(var e=0,n=this.children.length;n>e;e++){var i=this.children[e];t.save(),i.updateContext(t),i.draw(t),t.restore()}},add:function(t){arguments.length>1?this.children.push.apply(this.children,Array.prototype.slice.call(arguments)):this.children.push(t)},_getHitChild:function(t,e,n){var i=this.children.length;t.clearRect(0,0,t.canvas.width,t.canvas.height);for(var a=i-1;a>=0;a--){var r=this.children[a];if(t.save(),r.updateContext(t),r.draw(t),t.restore(),t.getImageData(e,n,1,1).data[3]>1)return r}}});return t", "c": "Kanvas.Container", "d": ["Kanvas.DisplayObject"] }, { "a": ["Container"], "b": "var t=__modules[\"Kanvas.Container\"].extend({ctor:function(t){this._super(),this.canvas=\"string\"==typeof t?document.querySelector(t):t,this.ctx=this.canvas.getContext(\"2d\"),this.width=this.canvas.width,this.height=this.canvas.height,this.hitCanvas=document.createElement(\"canvas\"),this.hitCanvas.width=this.width,this.hitCanvas.height=this.height,this.hitCtx=this.hitCanvas.getContext(\"2d\"),Function.prototype.bind=function(){var t=this,e=Array.prototype.slice.call(arguments),n=e.shift();return function(){return t.apply(n,e.concat(Array.prototype.slice.call(arguments)))}},this.canvas.addEventListener(\"click\",this._handleClick.bind(this),!1),this.offset=this._getXY(this.canvas)},update:function(){this.ctx.clearRect(0,0,this.width,this.height),this.draw(this.ctx)},_handleClick:function(t){var e=this._getHitChild(this.hitCtx,t.pageX-this.offset[0],t.pageY-this.offset[1]);e&&e.execEvent(t)},_getClientXY:function(t){var e=0,n=0;if(t)if(document.documentElement.getBoundingClientRect&&t.getBoundingClientRect){var i={left:0,top:0,right:0,bottom:0};try{i=t.getBoundingClientRect(),n=i.left,e=i.top}catch(a){return alert(1),[0,0]}}else for(;t.offsetParent;)e+=t.offsetTop,n+=t.offsetLeft,t=t.offsetParent;return[n,e]},_getXY:function(t){var e=this._getClientXY(t);return e[0]=e[0]+this._getScrollLeft(),e[1]=e[1]+this._getScrollTop(),e},_getScrollLeft:function(t){var e;return e=t?t.scrollLeft:Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),e||0},_getScrollTop:function(t){var e;return e=t?t.scrollTop:Math.max(document.documentElement.scrollTop,document.body.scrollTop),e||0}});return t", "c": "Kanvas.Stage", "d": ["Kanvas.Container"] }, { "a": ["DisplayObject"], "b": "var t=__modules[\"Kanvas.DisplayObject\"].extend({ctor:function(t,e,n){this._super(),this.text=t,this.font=e,this.color=n,this.textAlign=\"left\",this.textBaseline=\"top\"},draw:function(t){t.fillStyle=this.color,t.font=this.font,t.textAlign=this.textAlign||\"left\",t.textBaseline=this.textBaseline||\"top\",t.fillText(this.text,0,0)}});return t", "c": "Kanvas.Txt", "d": ["Kanvas.DisplayObject"] }, { "a": ["DisplayObject"], "b": "var t=__modules[\"Kanvas.DisplayObject\"].extend({ctor:function(t){this._super(),this.img=t},draw:function(t){t.drawImage(this.img,0,0)}});return t", "c": "Kanvas.Bitmap", "d": ["Kanvas.DisplayObject"] }, { "a": ["DisplayObject"], "b": "var t=__modules[\"Kanvas.DisplayObject\"].extend({ctor:function(t,e,n){this._super(),this.r=t||1,this.color=e||\"black\",this.isHollow=n},draw:function(t){t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI),this.isHollow?(t.strokeStyle=this.color,t.stroke()):(t.fillStyle=this.color,t.fill())}});return t", "c": "Kanvas.Shape.Circle", "d": ["Kanvas.DisplayObject"] }, { "a": ["Stage", "Txt", "Bitmap", "Container", "Circle"], "b": "var n=__class.extend({ctor:function(){var n=new Stage(\"#ourCanvas\"),e=new Txt(\"Hello Kanvas!\",\"bold 36px Arial\",\"green\");e.x=140,e.y=100,e.regX=100,e.regY=20,e.skewX=30,e.skewY=-30,e.rotation=20,n.add(e),n.update();var a=new Txt(\"KMD:Kill AMD and CMD!\",\"bold 26px Arial\",\"red\");a.y=400,a.on(\"click\",function(){alert(this.text)});var r=new Txt(\"Click Me!\",\"bold 46px Arial\",\"blue\");r.y=230,r.x=50,r.on(\"click\",function(){alert(this.text)});var t=new Image;t.onload=function(){var e=new Bitmap(t);e.x=100,e.y=100,n.add(e)},t.src=\"img/kmd.png\";var l,i=new Image;i.onload=function(){l=new Bitmap(i),l.x=164,l.y=334,l.regX=64,l.regY=64,n.add(l),l.on(\"click\",function(){alert(\"i am a pig\")})},i.src=\"img/pig.png\",n.add(a,r);var o=new Circle(55,\"red\");o.x=30,o.y=30,o.on(\"click\",function(){alert(\"i'm a red ball!\")});var c=new Circle(35,\"green\");c.x=30,c.y=30,c.on(\"click\",function(){alert(\"i'm a green ball!\")});var d=new Circle(18,\"yellow\");d.x=30,d.y=30,n.add(o,c,d);var x=new Container;x.x=268,x.y=58;var g=new Circle(48,\"#777777\"),w=new Txt(\"Container!\",\"bold 16px Arial\",\"white\");w.regX=40,w.regY=8,x.add(g,w),n.add(x),x.on(\"click\",function(){alert(\"i am a Container!\")}),setInterval(function(){e.rotation++,l&&l.rotation--,n.update()},15)}});return n", "c": "HelloKanvas.Main", "d": ["Kanvas.Stage", "Kanvas.Txt", "Kanvas.Bitmap", "Kanvas.Container", "Kanvas.Shape.Circle"] }], u.exec(t.all), new t.modules["HelloKanvas.Main"] })(this)